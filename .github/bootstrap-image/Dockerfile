# Use an official Python runtime as a parent image
FROM docker.repo.orl.eng.hitachivantara.com/python:3.8-slim

# Install the required Python packages using pip
RUN pip install pyyaml requests Pillow

# Copy the current directory contents into the container
COPY src/index.py /index.py

RUN dir -s  

# SET ENV VARIABLE
ENV STEPS_JSON=$STEPS_JSON
ENV TEAMS_WEBHOOK_URL=$TEAMS_WEBHOOK_URL
ENV JOB_STATUS=$JOB_STATUS
ENV GITHUB_ACTOR=$GITHUB_ACTOR
ENV GITHUB_EVENT_NAME=$GITHUB_EVENT_NAME
ENV GITHUB_EVENT_HEAD_COMMIT_URL=$GITHUB_EVENT_HEAD_COMMIT_URL
ENV GITHUB_EVENT_HEAD_COMMIT_MESSAGE=$GITHUB_EVENT_HEAD_COMMIT_MESSAGE
ENV GITHUB_SERVER_URL=$GITHUB_SERVER_URL
ENV GITHUB_REPOSITORY=$GITHUB_REPOSITORY
ENV GITHUB_PULL_REQUEST_NUMBER=$GITHUB_PULL_REQUEST_NUMBER
ENV GITHUB_BRANCH_REF=$GITHUB_BRANCH_REF
ENV GITHUB_RUN_ID=$GITHUB_RUN_ID
ENV SONAR_HOST_URL=$SONAR_HOST_URL
ENV SONAR_PROJECT_KEY=$SONAR_PROJECT_KEY
ENV UNIT_TEST_URL=$UNIT_TEST_URL

CMD ["python", "/index.py", \
    "$STEPS_JSON_ENV", "$GITHUB_ACTOR_ENV", \
    "$STEPS_JSON", "$TEAMS_WEBHOOK_URL", \
    "$JOB_STATUS", "$GITHUB_ACTOR", \
    "$GITHUB_EVENT_NAME", "$GITHUB_EVENT_HEAD_COMMIT_URL", \
    "$GITHUB_EVENT_HEAD_COMMIT_MESSAGE", "$GITHUB_SERVER_URL", \
    "$GITHUB_REPOSITORY", "$GITHUB_PULL_REQUEST_NUMBER", \
    "$GITHUB_BRANCH_REF", "$GITHUB_RUN_ID", \
    "$SONAR_HOST_URL", "$SONAR_PROJECT_KEY", \
    "$UNIT_TEST_URL"]

